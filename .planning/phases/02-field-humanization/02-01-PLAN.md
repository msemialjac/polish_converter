---
phase: 02-field-humanization
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified: [main.py, tests/test_humanization.py]
autonomous: true
---

<objective>
Add field humanization to convert technical field names to readable labels in pseudocode output.

Purpose: Make pseudocode genuinely readable for non-technical Odoo users by converting snake_case to Title Case, stripping _id/_ids suffixes, and humanizing dotted paths.
Output: Humanized field names in pseudocode output (Python output unchanged for now - Phase 4).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-custom-parser/01-01-SUMMARY.md
@main.py

**Phase 2 Requirements:**
- FIELD-01: Field names convert from snake_case to Title Case (`privacy_visibility` → "Privacy Visibility")
- FIELD-02: Field names strip `_id` suffix (`company_id` → "Company")
- FIELD-03: Field names strip `_ids` suffix (`group_ids` → "Groups")
- FIELD-04: Dotted paths humanize with possessive form (`project_id.privacy_visibility` → "Project's Privacy Visibility")

**From Phase 1:**
- DynamicRef class exists for variable references (user.id, company_ids)
- DynamicRef objects should NOT be humanized here (they represent variables, not fields)
- Field humanization applies only to the FIELD position (first element of condition tuple)

**Current State:**
- `convert_odoo_domain_to_pseudocode()` outputs raw field names: `(privacy_visibility is equal to "employees")`
- Goal: Output humanized names: `(Privacy Visibility is equal to "employees")`

**Edge Cases:**
- Single word fields: `active` → "Active"
- Already Title Case input: `Privacy_Visibility` → "Privacy Visibility"
- Dotted paths with _id: `project_id.privacy_visibility` → "Project's Privacy Visibility"
- Multiple dots: `account_id.partner_id.name` → "Account's Partner's Name"
- Fields ending in _id: `company_id` → "Company" (not "Company Id")
- Fields ending in _ids: `group_ids` → "Groups" (not "Group Ids")
</context>

<feature>
  <name>Field Humanization</name>
  <files>main.py, tests/test_humanization.py</files>
  <behavior>
    humanize_field(field_name: str) -> str

    **Test cases (input -> expected output):**

    1. Single word, lowercase:
       `"active"` → `"Active"`

    2. Snake_case, multiple words:
       `"privacy_visibility"` → `"Privacy Visibility"`

    3. Field ending in _id (strip suffix, singularize):
       `"company_id"` → `"Company"`

    4. Field ending in _ids (strip suffix, pluralize):
       `"group_ids"` → `"Groups"`

    5. Snake_case ending in _id:
       `"partner_shipping_id"` → `"Partner Shipping"`

    6. Snake_case ending in _ids:
       `"allowed_company_ids"` → `"Allowed Companies"`

    7. Dotted path (possessive form):
       `"project_id.name"` → `"Project's Name"`

    8. Dotted path with suffix stripping:
       `"project_id.privacy_visibility"` → `"Project's Privacy Visibility"`

    9. Multiple dots:
       `"account_id.partner_id.name"` → `"Account's Partner's Name"`

    10. Dotted path ending in _id:
        `"order_id.partner_id"` → `"Order's Partner"`

    11. Single char segments:
        `"x_field"` → `"X Field"` (custom fields often start with x_)

    12. Numbers in field names:
        `"field_2_name"` → `"Field 2 Name"`

    **Integration test cases:**
    Pseudocode conversion with humanization:

    `[('privacy_visibility', '=', 'employees')]`
    → `(Privacy Visibility is equal to "employees")`

    `[('company_id', '=', 1)]`
    → `(Company is equal to 1)`

    `[('project_id.privacy_visibility', '=', 'portal')]`
    → `(Project's Privacy Visibility is equal to "portal")`
  </behavior>
  <implementation>
    1. Create `humanize_field(field_name: str) -> str` function:
       - Split on dots to get path segments
       - For each segment:
         a. Strip _id suffix (singularize noun)
         b. Strip _ids suffix (pluralize noun)
         c. Replace underscores with spaces
         d. Convert to Title Case
       - Join segments with "'s " for possessive form
       - Last segment doesn't get possessive

    2. Create helper `_humanize_segment(segment: str) -> str`:
       - Handle _id suffix: remove, return singular
       - Handle _ids suffix: remove, make plural (simple 's' for most cases)
       - Replace _ with space
       - Apply title case

    3. Integrate into `convert_odoo_domain_to_pseudocode()`:
       - In `process_condition()`, apply `humanize_field()` to field name
       - Do NOT apply to DynamicRef (those are variable references, not fields)

    4. Keep `convert_odoo_domain_to_python()` unchanged (Phase 4 handles that)
  </implementation>
</feature>

<verification>
```bash
# Run tests
python -m pytest tests/test_humanization.py -v

# Manual verification
python -c "
from main import humanize_field, convert_odoo_domain_to_pseudocode, parse_domain

# Field humanization
print(humanize_field('privacy_visibility'))  # Privacy Visibility
print(humanize_field('company_id'))  # Company
print(humanize_field('group_ids'))  # Groups
print(humanize_field('project_id.name'))  # Project's Name

# Full conversion
domain = parse_domain(\"[('privacy_visibility', '=', 'employees')]\")
print(convert_odoo_domain_to_pseudocode(domain))
# Should show: (Privacy Visibility is equal to \"employees\")
"
```
</verification>

<success_criteria>
- humanize_field() function created and handles all transformation cases
- All 12+ test cases pass
- Pseudocode output uses humanized field names
- Python output unchanged (still uses raw field names)
- Dotted paths use possessive form with "'s"
- _id and _ids suffixes properly stripped
- DynamicRef values not affected (they're variable references)
- RED-GREEN-REFACTOR cycle completed with atomic commits
</success_criteria>

<output>
After completion, create `.planning/phases/02-field-humanization/02-01-SUMMARY.md` with:
- RED: What tests were written, why they failed
- GREEN: What implementation made them pass
- REFACTOR: What cleanup was done
- Commits: List of commits produced
- Requirements satisfied: FIELD-01, FIELD-02, FIELD-03, FIELD-04
</output>
