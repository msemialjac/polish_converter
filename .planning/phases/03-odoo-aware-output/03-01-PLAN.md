---
phase: 03-odoo-aware-output
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified: [main.py, tests/test_odoo_aware.py]
autonomous: true
---

<objective>
Add Odoo-aware output enhancements: system field mappings, user reference humanization, and value humanization (False/None as "Not set", tautology patterns).

Purpose: Make pseudocode genuinely readable for Odoo users by using familiar UI labels and natural language.
Output: Pseudocode with system field names, humanized user references, and humanized values.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-field-humanization/02-01-SUMMARY.md
@main.py

**Phase 3 Requirements:**
- ODOO-01: Common system fields map to UI labels (`create_uid` → "Created By", `write_uid` → "Last Updated By", `create_date` → "Created On", `write_date` → "Last Updated On", `active` → "Active")
- ODOO-02: User references render as human-readable (`user.id` → "current user", `user.partner_id.id` → "current user's Partner", `user.groups_id.ids` → "current user's Groups")
- VALUE-01: `False` and `None` render as "Not set" in pseudocode
- VALUE-02: `(1, '=', 1)` pattern renders as "Always True (all records)"
- VALUE-03: `(0, '=', 1)` pattern renders as "Always False (no records)"

**From Phase 2:**
- humanize_field() exists for snake_case to Title Case conversion
- DynamicRef class wraps variable references (user.id, company_ids)
- format_value() in pseudocode currently returns "False", "None" as-is

**Current State:**
- `create_uid` → "Create Uid" (generic humanization)
- `user.id` (DynamicRef) → "user.id" (raw output)
- `False` → "False" (raw boolean)
- `(1, '=', 1)` → "(1 is equal to 1)" (literal output)

**Desired State:**
- `create_uid` → "Created By" (Odoo UI label)
- `user.id` (DynamicRef) → "current user" (human-readable)
- `False` → "Not set" (user-friendly)
- `(1, '=', 1)` → "Always True (all records)" (recognized pattern)
</context>

<feature>
  <name>Odoo-Aware Output</name>
  <files>main.py, tests/test_odoo_aware.py</files>
  <behavior>
    **ODOO-01: System field mappings**
    get_system_field_label(field_name: str) -> str | None
    Returns UI label if field is a known system field, None otherwise.

    Test cases:
    - `"create_uid"` → `"Created By"`
    - `"write_uid"` → `"Last Updated By"`
    - `"create_date"` → `"Created On"`
    - `"write_date"` → `"Last Updated On"`
    - `"active"` → `"Active"`
    - `"id"` → `"ID"`
    - `"display_name"` → `"Display Name"`
    - `"name"` → `None` (not a system field, use humanize_field)
    - `"custom_field"` → `None` (not a system field)

    **ODOO-02: User reference humanization**
    humanize_dynamic_ref(ref: DynamicRef) -> str
    Returns human-readable string for variable references.

    Test cases:
    - `DynamicRef("user.id")` → `"current user"`
    - `DynamicRef("user.partner_id.id")` → `"current user's Partner"`
    - `DynamicRef("user.partner_id")` → `"current user's Partner"`
    - `DynamicRef("user.groups_id.ids")` → `"current user's Groups"`
    - `DynamicRef("user.company_id.id")` → `"current user's Company"`
    - `DynamicRef("user.company_ids")` → `"current user's Companies"`
    - `DynamicRef("company_ids")` → `"company_ids"` (not user ref, keep as-is)
    - `DynamicRef("context.get('active_id')")` → `"context.get('active_id')"` (complex, keep as-is)

    **VALUE-01: False/None humanization**
    In format_value() for pseudocode:
    - `False` → `"Not set"`
    - `None` → `"Not set"`
    - `True` → `"True"` (unchanged)
    - Other values unchanged

    **VALUE-02/VALUE-03: Tautology patterns**
    In process_condition() for pseudocode:
    - `(1, '=', 1)` → `"Always True (all records)"`
    - `(0, '=', 1)` → `"Always False (no records)"`
    - `('1', '=', '1')` → `"Always True (all records)"` (string comparison)

    **Integration test cases:**
    Full pseudocode conversion:

    `[('create_uid', '=', user.id)]`
    → `(Created By is equal to current user)`

    `[('active', '=', False)]`
    → `(Active is equal to Not set)`

    `[(1, '=', 1)]`
    → `Always True (all records)`

    `[('|', ('user_id', '=', user.id), ('company_id', 'in', user.company_ids))]`
    → `(User is equal to current user)
    OR
    (Company is in current user's Companies)`
  </behavior>
  <implementation>
    1. Create SYSTEM_FIELD_LABELS dictionary:
       ```python
       SYSTEM_FIELD_LABELS = {
           'create_uid': 'Created By',
           'write_uid': 'Last Updated By',
           'create_date': 'Created On',
           'write_date': 'Last Updated On',
           'active': 'Active',
           'id': 'ID',
           'display_name': 'Display Name',
       }
       ```

    2. Create get_system_field_label(field_name: str) -> str | None:
       - Check if field_name (without dots) is in SYSTEM_FIELD_LABELS
       - Return label or None

    3. Create humanize_dynamic_ref(ref: DynamicRef) -> str:
       - If starts with "user.": handle specially
         - "user.id" → "current user"
         - "user.X.id" → "current user's X" (humanize X)
         - "user.X_ids" → "current user's Xs" (humanize X with plural)
         - "user.X" → "current user's X" (humanize X)
       - Otherwise return str(ref) unchanged

    4. Update format_value() in convert_odoo_domain_to_pseudocode():
       - DynamicRef: call humanize_dynamic_ref()
       - False: return "Not set"
       - None: return "Not set"
       - Other values unchanged

    5. Update process_condition() in convert_odoo_domain_to_pseudocode():
       - Detect tautology: (1, '=', 1) or ('1', '=', '1') → "Always True (all records)"
       - Detect tautology: (0, '=', 1) or ('0', '=', '1') → "Always False (no records)"
       - For field: check get_system_field_label() first, fall back to humanize_field()

    6. Keep convert_odoo_domain_to_python() unchanged (Phase 4)
  </implementation>
</feature>

<verification>
```bash
# Run tests
python -m pytest tests/test_odoo_aware.py -v

# Manual verification
python -c "
from main import (
    get_system_field_label, humanize_dynamic_ref, DynamicRef,
    convert_odoo_domain_to_pseudocode, parse_domain
)

# System fields
print(get_system_field_label('create_uid'))  # Created By
print(get_system_field_label('custom_field'))  # None

# User references
print(humanize_dynamic_ref(DynamicRef('user.id')))  # current user
print(humanize_dynamic_ref(DynamicRef('user.partner_id.id')))  # current user's Partner

# Full conversion
domain = parse_domain(\"[('create_uid', '=', user.id)]\")
print(convert_odoo_domain_to_pseudocode(domain))
# Should show: (Created By is equal to current user)

domain = parse_domain(\"[(1, '=', 1)]\")
print(convert_odoo_domain_to_pseudocode(domain))
# Should show: Always True (all records)
"
```
</verification>

<success_criteria>
- SYSTEM_FIELD_LABELS dictionary with common Odoo system fields
- get_system_field_label() returns UI labels for system fields
- humanize_dynamic_ref() converts user.* references to readable form
- format_value() renders False/None as "Not set"
- process_condition() recognizes tautology patterns
- All integration tests pass
- Python output unchanged (still uses raw values)
- RED-GREEN-REFACTOR cycle completed with atomic commits
</success_criteria>

<output>
After completion, create `.planning/phases/03-odoo-aware-output/03-01-SUMMARY.md` with:
- RED: What tests were written, why they failed
- GREEN: What implementation made them pass
- REFACTOR: What cleanup was done
- Commits: List of commits produced
- Requirements satisfied: ODOO-01, ODOO-02, VALUE-01, VALUE-02, VALUE-03
</output>
