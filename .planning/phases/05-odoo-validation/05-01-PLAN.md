---
phase: 05-odoo-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified: [main.py]
autonomous: true
---

<objective>
Create Odoo XML-RPC client connection and GUI settings panel.

Purpose: Enable the tool to connect to an Odoo instance for domain validation. Users can configure connection settings through a dedicated panel.
Output: OdooConnection class with authenticate/test methods, GUI settings panel with URL/database/username/password fields.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@main.py

**Phase 5 Requirements (this plan):**
- VALID-01: Connect to Odoo instance via XML-RPC API
- VALID-02: GUI settings panel for Odoo connection (URL, database, username, password)

**Odoo instance for testing:**
- URL: http://localhost:8069
- Database: (will query available databases)
- Username: admin
- Password: admin

**Odoo XML-RPC API:**
- Common endpoint: /xmlrpc/2/common (version, authenticate)
- Object endpoint: /xmlrpc/2/object (execute_kw for model operations)
- Uses Python's built-in xmlrpc.client (no external deps needed)

**Current GUI structure:**
- FreeSimpleGUI window with: title, input multiline, radio buttons (Python/Pseudocode), Convert button, output multiline
- Need to add: Settings button that opens modal with connection fields
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create OdooConnection class</name>
  <files>main.py</files>
  <action>
    Create OdooConnection class with:

    1. Constructor takes url, database, username, password
    2. `test_connection()` method:
       - Connect to /xmlrpc/2/common
       - Call `version()` to verify connection
       - Return (success: bool, message: str)

    3. `authenticate()` method:
       - Call common.authenticate(db, username, password, {})
       - Return uid or None if failed

    4. `get_databases()` class method:
       - Connect to /xmlrpc/2/db
       - Call `list()` to get available databases
       - Return list of database names

    5. Store uid after successful authenticate for later use

    Use Python's built-in xmlrpc.client - no external deps needed.

    Handle errors gracefully:
    - Connection refused -> "Cannot connect to {url}"
    - Authentication failed -> "Invalid credentials"
    - Database not found -> "Database '{db}' not found"
  </action>
  <verify>
    python -c "
    from main import OdooConnection
    conn = OdooConnection('http://localhost:8069', 'your_db', 'admin', 'admin')
    success, msg = conn.test_connection()
    print(f'Connection: {success}, {msg}')
    "
  </verify>
  <done>OdooConnection class exists with test_connection, authenticate, get_databases methods</done>
</task>

<task type="auto">
  <name>Task 2: Add GUI settings panel</name>
  <files>main.py</files>
  <action>
    Modify GUI to add settings functionality:

    1. Add "Settings" button to main layout (next to Convert button)

    2. Create `show_settings_window()` function that opens a modal:
       - URL input (default: http://localhost:8069)
       - Database dropdown (populated from get_databases(), or text input if unreachable)
       - Username input (default: admin)
       - Password input (password field, default: admin)
       - "Test Connection" button
       - "Save" and "Cancel" buttons
       - Status text showing connection result

    3. Store settings in global dict or module-level variable for persistence during session

    4. When "Test Connection" clicked:
       - Create OdooConnection with current field values
       - Call test_connection()
       - Show result in status text (green for success, red for error)

    5. When "Save" clicked:
       - Store settings
       - Close modal

    Keep UI simple - match existing FreeSimpleGUI style with Helvetica 20 font.
  </action>
  <verify>
    Run the GUI manually:
    python main.py
    - Click Settings button
    - Verify modal opens with all fields
    - Test connection with localhost:8069
    - Save and verify settings persist
  </verify>
  <done>Settings button visible, modal opens with connection fields, test connection works</done>
</task>

</tasks>

<verification>
```bash
# Verify OdooConnection class exists and works
python -c "
from main import OdooConnection
import xmlrpc.client

# Test class exists
conn = OdooConnection('http://localhost:8069', 'test', 'admin', 'admin')
print('OdooConnection class: OK')

# Test connection method exists
print(f'test_connection method: {hasattr(conn, \"test_connection\")}')
print(f'authenticate method: {hasattr(conn, \"authenticate\")}')
print(f'get_databases method: {hasattr(OdooConnection, \"get_databases\")}')
"

# Run tests
python -m pytest tests/ -v --tb=short
```
</verification>

<success_criteria>
- OdooConnection class with test_connection(), authenticate(), get_databases()
- Error handling for connection failures
- GUI Settings button visible in main window
- Settings modal with URL, database, username, password fields
- Test Connection button that validates credentials
- Settings saved for session
- All existing tests still pass
</success_criteria>

<output>
After completion, create `.planning/phases/05-odoo-validation/05-01-SUMMARY.md` with:
- OdooConnection implementation details
- GUI changes made
- Any connection/authentication challenges encountered
- Commits produced
- Requirements satisfied: VALID-01, VALID-02
</output>
