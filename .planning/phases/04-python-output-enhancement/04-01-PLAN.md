---
phase: 04-python-output-enhancement
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified: [main.py, tests/test_python_output.py]
autonomous: true
---

<objective>
Apply field humanization to Python output while maintaining readable Python-like syntax.

Purpose: Make Python output equally readable as pseudocode for non-technical users, while preserving recognizable Python structure.
Output: Python output with humanized field names, system field labels, and user references.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/tdd.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-odoo-aware-output/03-01-SUMMARY.md
@main.py

**Phase 4 Requirements:**
- PYOUT-01: Python output applies field humanization
- PYOUT-02: Python output maintains readable syntax while being Python-like

**From Phase 2 & 3 (available functions):**
- humanize_field() - converts snake_case to Title Case, strips _id/_ids
- get_system_field_label() - returns UI labels for system fields
- humanize_dynamic_ref() - converts user.* references to readable form

**Current State (convert_odoo_domain_to_python):**
- `create_uid` → `create_uid` (raw field name)
- `user.id` (DynamicRef) → `user.id` (raw output)
- `False` → `False` (raw boolean)
- Output: `(create_uid == user.id)` (raw)

**Desired State:**
- `create_uid` → `Created_By` (system field, Python-safe)
- `user.id` (DynamicRef) → `current_user` (humanized, Python-safe)
- `False` → `Not_Set` (humanized, Python-safe)
- Output: `(Created_By == current_user)` (readable but Python-like)

**Key Design Decision:**
Python output should use underscores instead of spaces to maintain Python-like appearance:
- "Created By" → "Created_By"
- "current user" → "current_user"
- "Not set" → "Not_Set"
This keeps output looking like valid Python identifiers while being readable.
</context>

<feature>
  <name>Python Output Humanization</name>
  <files>main.py, tests/test_python_output.py</files>
  <behavior>
    **PYOUT-01: Field humanization in Python output**
    Modify convert_odoo_domain_to_python() to humanize fields:

    Test cases:
    - `[('create_uid', '=', 1)]` → `(Created_By == 1)`
    - `[('write_date', '>', '2024-01-01')]` → `(Last_Updated_On > '2024-01-01')`
    - `[('active', '=', True)]` → `(Active == True)`
    - `[('company_id', '=', 1)]` → `(Company == 1)`
    - `[('user_ids', 'in', [1, 2])]` → `(Users in [1, 2])`
    - `[('project_id.name', '=', 'Test')]` → `(Project's_Name == 'Test')`

    **PYOUT-02: DynamicRef humanization in Python output**
    Test cases:
    - `[('user_id', '=', user.id)]` → `(User == current_user)`
    - `[('company_id', 'in', user.company_ids)]` → `(Company in current_user's_Companies)`
    - `[('partner_id', '=', user.partner_id.id)]` → `(Partner == current_user's_Partner)`

    **Value humanization (optional for Python, keeping Python-valid):**
    - `False` values remain as `False` (valid Python)
    - `None` values remain as `None` (valid Python)
    - These differ from pseudocode which uses "Not set"

    **Integration test cases:**
    Full Python conversion:

    `[('create_uid', '=', user.id)]`
    → `(Created_By == current_user)`

    `[('|', ('user_id', '=', user.id), ('company_id', 'in', user.company_ids))]`
    → `((User == current_user) or (Company in current_user's_Companies))`

    `[('active', '=', False)]`
    → `(Active == False)`

    `[('project_id.privacy_visibility', '=', 'followers')]`
    → `(Project's_Privacy_Visibility == 'followers')`
  </behavior>
  <implementation>
    1. Create helper function to convert humanized text to Python-safe identifiers:
       ```python
       def to_python_identifier(text: str) -> str:
           """Convert humanized text to Python-safe identifier.

           Replaces spaces with underscores and removes apostrophes.
           Example: "current user's Partner" -> "current_user's_Partner"
           """
           return text.replace(' ', '_')
       ```

    2. Update format_value() in convert_odoo_domain_to_python():
       - DynamicRef: call humanize_dynamic_ref() then to_python_identifier()
       - Keep False as False (valid Python)
       - Keep None as None (valid Python)
       - Other values unchanged

    3. Update process_condition() in convert_odoo_domain_to_python():
       - For field: check get_system_field_label() first, fall back to humanize_field()
       - Apply to_python_identifier() to the result
       - Keep operators as Python operators (==, in, etc.)

    4. Ensure output maintains Python structure:
       - Parentheses for grouping
       - `and`/`or`/`not` for logical operators
       - Valid Python-like identifiers (underscores, no spaces)
  </implementation>
</feature>

<verification>
```bash
# Run tests
python -m pytest tests/test_python_output.py -v

# Manual verification
python -c "
from main import convert_odoo_domain_to_python, parse_domain

# System fields
domain = parse_domain(\"[('create_uid', '=', 1)]\")
print(convert_odoo_domain_to_python(domain))
# Should show: (Created_By == 1)

# User references
domain = parse_domain(\"[('user_id', '=', user.id)]\")
print(convert_odoo_domain_to_python(domain))
# Should show: (User == current_user)

# Field humanization with path
domain = parse_domain(\"[('project_id.name', '=', 'Test')]\")
print(convert_odoo_domain_to_python(domain))
# Should show: (Project's_Name == 'Test')

# Complex domain
domain = parse_domain(\"[('|', ('active', '=', True), ('create_uid', '=', user.id))]\")
print(convert_odoo_domain_to_python(domain))
# Should show: ((Active == True) or (Created_By == current_user))
"
```
</verification>

<success_criteria>
- to_python_identifier() helper converts spaces to underscores
- format_value() humanizes DynamicRef values with Python-safe output
- process_condition() applies system field labels and humanize_field()
- Python output structure preserved (parentheses, operators)
- All integration tests pass
- Pseudocode output unchanged (still uses spaces)
- RED-GREEN-REFACTOR cycle completed with atomic commits
</success_criteria>

<output>
After completion, create `.planning/phases/04-python-output-enhancement/04-01-SUMMARY.md` with:
- RED: What tests were written, why they failed
- GREEN: What implementation made them pass
- REFACTOR: What cleanup was done
- Commits: List of commits produced
- Requirements satisfied: PYOUT-01, PYOUT-02
</output>
